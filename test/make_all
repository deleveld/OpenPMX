set -eu


# supplement model figures
make_plots()
{
	dot -Tpdf ${1} >figure_${2}.pdf
	dot -Tjpg -Gdpi=300 ${1} >figure_${2}.jpg
	convert figure_${2}.jpg -trim figure_${2}.jpg	
}

make_plots schnider.dot		supplement_1
make_plots sparse.dot		supplement_4
make_plots fentanyl.dot		supplement_7
make_plots warfarin.dot		supplement_10
make_plots datasim.dot		supplement_13

move_figures()
{
	mv -v ${1}/analysis2.pdf_${2}.pdf figure_${3}.pdf
	mv -v ${1}/analysis2.pdf_${2}.jpg figure_${3}.jpg
	convert figure_${3}.jpg -rotate 90 figure_${3}.jpg
	convert figure_${3}.jpg -trim figure_${3}.jpg
}

do_run()
{
###	(cd "${1}"; ./analysis2 dataset; ./analysis2 nonmem; ./analysis2 openpmx; ./analysis2)
	(cd "${1}"; ./analysis2 nonmem; ./analysis2 openpmx; ./analysis2)
	
	move_figures "${1}"	2	"${2}"
	move_figures "${1}"	1	"${3}"
	move_figures "${1}"	3	"${4}"
}

do_run schnider	1	supplement_2	supplement_3
do_run schnider_2core	102	speed_none_4_1	speed_4_2
do_run schnider_4core	104	speed_none_4_1	speed_4_2
do_run schnider_8core	108	speed_none_8_1	speed_8_2
do_run schnider_12core	112	speed_none_12_1	speed_12_2
do_run schnider_16core	116	speed_none_16_1	speed_16_2
do_run schnider_24core	124	speed_none_24_1	speed_24_2

do_run sparse	2	supplement_5	supplement_6
do_run fentanyl	3	supplement_8	supplement_9
do_run warfarin	4	supplement_11	supplement_12
do_run datasim	5	supplement_14	supplement_15
cp -v datasim/bias.csv	table_datasim_bias.csv
cp -v datasim/rmse.csv	table_datasim_rmse.csv

